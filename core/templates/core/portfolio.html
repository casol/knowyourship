{% extends "core/index.html" %}
{% load staticfiles %}

{% block content %}

<!-- Header -->
<header class="header" id="top">
  <div class="text-vertical-center">
    <h1>Know Your Ship</h1>
    <h3>Find ships museum all over the world!</h3>
    <br>
    <a href="{% url 'core:ship_search' %}" class="btn btn-dark btn-lg js-scroll-trigger">Find More</a>
  </div>
</header>

<hr>

<div id="map"></div>

<section id="portfolio" class="portfolio">
    <script>
        var ship_name = '{{ ship.ship }}';
        var url = '{{ ship.url }}';
        var search = '{{ ship.ship }}%2C{{ ship.city }}';
        var country = '{{ ship.country }}';
        var latitude = {{ ship.coordinates.latitude }};
        var longitude = {{ ship.coordinates.longitude }};
        search = search.replace(/\s+/g, '+');
    </script>

  <script src="{% static 'core/js/ship_details_map.js' %}"></script>
  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <div class="row">
          <div class="col-md-5">
            <div class="portfolio-item">
                <div class="card border-dark">
                      <div class="card-body text-dark">
                          <img class="card-img-top" src="{{ ship.ship_image.image.url }}" onerror="ImgError(this)">
                      </div>
                    <div class="card-footer">
                        {% if ship.ship_image.image.url %}
                          <small class="text-muted">(Author: {{ ship.ship_image.artist }})</small>
                          <small class="text-muted">({{ ship.ship_image.license_short_name }})</small>
                          <small class="text-muted"><a href="{{ ship.ship_image.source_url}}">({{ ship.ship_image.title }})</a></small><br>
                          <small class="text-muted">{{ ship.ship_image.image_description }}</small>
                          {% else %}
                          <div id="ship_img"></div>
                          {% endif %}
                    </div>
                </div>
            </div>
          </div>
          <div class="col-md-7">
            <div class="portfolio-item">
                <div class="card border-dark">
                      <div class="card-body text-dark">
                          <div class="card-title">
                              <h1>
                                  <span class="card-title"><strong>{{ ship.ship }}</strong></span>
                                  <button type="button" class="btn btn-primary btn-sm float-right">
                                      View{{ total_views|pluralize}} <span class="badge badge-light">{{ total_views }}</span>
                                      <span class="sr-only">total views</span>
                                  </button>
                              </h1>
                          </div>
                          {% if ship.details.content|length > 200 %}
                            <p class="card-text">{{ ship.details.content }}</p>
                                <small><li><a href="{{ ship.url }}">Source</a></li></small>
                          {% elif ship.details.content|length > 100 %}
                            <p class="card-text">{{ ship.details.content }}</p><br>
                                <small>Would you like to see some more details?</small><br>
                                <small>If you would like to contribute please go to <a href="{{ ship.url }}">Wikipedia page.</a></small>

                          {% elif ship.details.content|length < 10 %}
                            <p class="card-text">{{ ship.details.content }}</p>
                                <p>Would you like to see some more details?</p>
                                <p>If you would like to contribute please go to <a href="{{ ship.url }}">Wikipedia page.</a></p>
                          {% endif %}
                      </div>
                </div>
            </div>
          </div>
        </div>
        <!-- /.row (nested) -->
          <div class="text-center">
              <div class="card">
                      <div class="card-body">
                          <a href="{{ ship.url }}" class="btn btn-dark">Go to Wikipedia page!</a>
                      </div>
              </div>
          </div>
      </div>
      <!-- /.col-lg-10 -->
    </div>
                <hr>
                <div class="card border-dark">
                      <div class="card-body text-dark">
                        {% with comments.count as total_comments %}
                         <h2>
                         {{ total_comments }} comment{{ total_comments|pluralize }}
                         </h2>
                        {% endwith %}

                          {% for comment in comments %}
                         <div class="comment" style="background-color: powderblue">
                             <p class="info">
                             Comment {{ forloop.counter }} by {{ comment.name }}
                             {{ comment.created }}
                             </p>
                             {{ comment.body|linebreaks }}
                                 <div class="comment" style="background-color: yellow">
                                 {% for replay in comment.replies.all %}
                                     <li>
                                     {{ replay.body }}
                                     </li>
                                 {% endfor %}
                                 </div>
                         </div>
                        {% empty %}
                         <p>There are no comments yet.</p>
                        {% endfor %}

                          {% if new_comment %}
                         <h2>Your comment has been added.</h2>
                        {% else %}
                         <h2>Add a new comment</h2>
                         <form action="." method="post">
                         {{ comment_form.as_p }}
                         {% csrf_token %}
                         <p><input type="submit" value="Add comment"></p>
                         </form>
                        {% endif %}
                      </div>
                </div>
                <hr>
     <div class="card border-dark">
      <div class="card-body text-dark">
                    <!-- Comments Form -->
          <div class="card my-4">
            <h5 class="card-header">Leave a Comment:</h5>
            <div class="card-body">
              <form>
                <div class="form-group">
                  <textarea class="form-control" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
              </form>
            </div>
          </div>

          <!-- Single Comment -->
          <div class="media mb-4">
            <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
              <i class="fa fa-ship fa-stack-1x" aria-hidden="true"></i>
            </span>
            <div class="media-body">
              <h5 class="mt-0">Commenter Name</h5>
              Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.
            </div>
          </div>

          <!-- Comment with nested comments -->
          <div class="media mb-4">
            <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
            <div class="media-body">
              <h5 class="mt-0">Commenter Name</h5>
              Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.

              <div class="media mt-4">
                <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                <div class="media-body">
                  <h5 class="mt-0">Commenter Name</h5>
                  Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.
                </div>
              </div>

              <div class="media mt-4">
                <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                <div class="media-body">
                  <h5 class="mt-0">Commenter Name</h5>
                  Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque ante sollicitudin. Cras purus odio, vestibulum in vulputate at, tempus viverra turpis. Fusce condimentum nunc ac nisi vulputate fringilla. Donec lacinia congue felis in faucibus.
                </div>
              </div>

            </div>
          </div>

        </div>

      </div>
     </div>
    <!-- /.row -->
  </div>
  <!-- /.container -->
    {% comment %}
    <script>
        window.onload = function(){
         $('html, body').animate({
                  scrollTop: $("#map").offset().top
                }, 1000, "easeInOutExpo");
        };
    </script>
    {% endcomment %}
    <script>
        function ImgError(source){
            source.src = "http://www.wikihow.com/images/4/4d/Draw-a-Ship-Step-20-Version-2.jpg";
            source.onerror = "";
            var msg = 'Nice one? kinda... Would you like to add proper ship picture? Just visit <a href="{{ ship.url }}">Wikipedia page</a> and add some images!';
            document.getElementById('ship_img').innerHTML = msg;
            return true;
        }
    </script>
</section>

{% endblock %}
